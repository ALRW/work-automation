<script src="https://cdn.jsdelivr.net/npm/vega@5.0.0-rc2"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@3.0.0-rc13"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@3.29.1"></script>
<script type="text/javascript">

  function preventFormSubmit() {
    var forms = document.querySelectorAll('form');
    for (var i = 0; i < forms.length; i++) {
      forms[i].addEventListener('submit', function(event) {
        event.preventDefault();
      });
    }
  }
  window.addEventListener('load', preventFormSubmit)

  function addSustain(data) {
    var htmlString = ' \
    <ul class="list-group"> \
      <li class="list-group-item list-group-item-secondary fc">Sustain</li> \
      <li class="list-group-item">' + data.sustain + '</li> \
    </ul>'
    document.getElementById('sustain').innerHTML = htmlString
  }

  function addImprove(data) {
    var htmlString = ' \
    <ul class="list-group"> \
      <li class="list-group-item list-group-item-secondary fc">Improve</li> \
      <li class="list-group-item">' + data.improve + '</li> \
    </ul>'
    document.getElementById('improve').innerHTML = htmlString
  }

  function onSuccess(data) {
    var yourVlSpec = {
      $schema: 'https://vega.github.io/schema/vega-lite/v2.0.json',
      description: '360 feedback output',
      title: '360 feedback results',
      width: 600,
      height: 350,
      data: data.body,
      layer: [
        {
          mark: {type: 'point', size: 70, filled: true},
          encoding: {
            x: {field: 'value', type: 'nominal'},
            y: {field: 'result', type: 'quantitative'}
          },
        },
        {
          mark: 'rule',
          encoding: {
            y: {field: 'result', type: 'quantitative', aggregate: 'mean'},
            size: {value: 2},
            color: {value: 'red'}
          }
        }
      ]};
    addSustain(data)
    vegaEmbed('#vis', yourVlSpec)
    addImprove(data)
  }

  (function () {
    var spinner = document.getElementById('loading')
    var app = document.getElementById('app')
    spinner.style.display = 'none'
    app.classList.remove('hidden')
  })()
</script>
